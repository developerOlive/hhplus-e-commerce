# 📝 E-commerce 서비스 요구사항 분석

---
<br>

## 1. 기능 개요
사용자는 다음과 같이 서비스를 이용할 수 있습니다. <br>

✅  상품 정보를 조회할 수 있습니다. (ID, 이름, 가격, 잔여수량 등) <br>
✅ 최근 3일간 가장 많이 팔린 상품 정보 5개를 확인할 수 있습니다. <br>
✅ 결제에 사용할 금액을 미리 충전하고, 잔액을 조회할 수 있습니다. <br>
✅ 선착순으로 할인 쿠폰을 발급받을 수 있습니다. <br>
✅ 원하는 상품을 선택한 후 주문 및 결제를 할 수 있습니다. <br>
  - 결제 시 <br>
    - 유효한 할인 쿠폰이 있으면, 전체 주문금액에 대해 할인을 받을 수 있습니다. <br>
  - 결제 완료 시 <br>
    - 잔액이 차감됩니다. <br>
    - (쿠폰을 사용한 경우) 쿠폰 사용 처리가 됩니다. <br>
    - 상품 재고가 차감됩니다. <br>
    - 주문 정보가 외부 데이터 플랫폼으로 실시간 전송됩니다. <br>

<br><br>


---

## 2. 기능 요구사항

### 📌 사용자 잔액
- [ ] 사용자 ID를 통해 현재 잔액을 조회할 수 있다.
- [ ] 사용자 ID와 금액을 입력받아 잔액을 충전할 수 있다.

### 📌 상품 조회
- [ ] 전체 상품 목록을 조회할 수 있다.
- [ ] 상품 정보에는 ID, 이름, 가격, 재고 수량이 포함되어야 한다.

### 📌 쿠폰
- [ ] 사용자가 보유한 쿠폰 목록을 조회할 수 있다.
- [ ] 선착순으로 쿠폰을 발급받을 수 있다.
- [ ] 유효한 쿠폰인 경우, 결제 시 할인을 받을 수 있다.

### 📌 주문 및 결제
- [ ] 사용자는 상품을 선택하여 주문을 할 수 있다.
- [ ] 주문 시 유효한 쿠폰을 적용하여 금액을 할인 받을 수 있다.
- [ ] 결제 성공 시 다음 항목이 모두 수행되어야 한다.
    - [ ] 사용자 잔액 차감
    - [ ] 상품 재고 수량 차감
    - [ ] 쿠폰 사용 처리 (사용된 경우)
    - [ ] 주문 정보 저장
    - [ ] 외부 데이터 플랫폼으로 주문 정보 전송

### 📌 인기 상품 조회
- [ ] 최근 3일간 가장 많이 팔린 상위 5개 상품을 조회할 수 있다.

<br><br>

---

##  3. 시나리오 기반 기능 흐름

### [ 요약 ] <br>
> “상품 조회 → 쿠폰 발급 → 잔액 충전 → 주문 → 결제 → 결제 완료 반영” <br>

<br> 
※ 쿠폰 발급은 잔액 충전 여부와 관계없이 언제든 가능하며, <br>
실질적인 쿠폰 적용 여부는 결제 시점에 검증됩니다. <br>
임의의 시나리오를 위해 위와 같이 순서를 설정하였습니다.

<br><br>

### [ 상세 ] <br>

1️⃣ 사용자 A는 인기 상품 랭킹을 통해 현재 많이 팔리는 상품을 확인합니다.<br>
2️⃣ 전체 상품 목록을 조회하고, 원하는 상품을 선택합니다.<br>
3️⃣ 잔액 충전 화면으로 이동해 사용할 금액을 충전합니다.<br>
4️⃣ 선착순 할인 쿠폰을 발급받습니다.<br>
  - ※ 잔여 수량이 없는 경우 발급되지 않습니다.<br>
5️⃣ 주문 화면에서 선택한 상품을 확인하고, 발급받은 쿠폰을 적용합니다.<br>
6️⃣ 결제를 요청합니다.<br>
  - 이 때 다음 조건들을 검증합니다<br>
     ✅ 쿠폰이 유효해야 하며, 그렇지 않은 경우 결제가 실패합니다.<br>
     ✅ 상품 재고가 충분해야 하며, 부족할 경우 결제가 실패합니다.<br>
     ✅ 사용자 잔액이 충분해야 하며, 부족할 경우 결제가 실패합니다.<br>
7️⃣ 결제 완료 후 다음 처리가 진행됩니다.<br>
   ✅ 사용자 잔액 차감<br>
   ✅ 상품 재고 차감<br>
   ✅ 쿠폰이 사용된 경우, 해당 쿠폰은 ‘사용 완료’ 상태로 변경<br>
   ✅ 주문 정보가 외부 데이터 플랫폼으로 전송<br>



<br><br>

---

## 비기능 요구사항 및 기술적 고려사항

### ⚠️ 동시성 처리

여러 사용자가 동시에 주문하거나 쿠폰을 발급받는 상황에서도  
데이터 정합성이 깨지지 않도록 하기 위한 고려가 필요합니다.

| 구분 | 설명 | 기술적 고려 방안                         |
|------|------|-----------------------------------|
| **사용자 잔액** | 동시에 여러 주문이 들어와도 사용자 잔액이 정확히 차감되어야 함 | Redis 분산 락, DB 락                  |
| **재고 관리** | 상품 재고가 부족할 경우, 중복 주문이 발생하지 않아야 함 | DB 락, 재고 차감 전 검증 쿼리, 재고 테이블 분리    |
| **쿠폰 발급** | 선착순 쿠폰이 초과 발급되지 않아야 함 | Redis SETNX, 원자성 있는 카운팅 로직, 동시성 큐 |

<br>

### 🔄 트랜잭션 보장

| 설명 | 기술적 고려 방안 |
|------|------------------|
| 결제 실패 시, 잔액 차감, 재고 차감, 쿠폰 사용 등 모든 처리가 일관되게 롤백되어야 함 | 서비스 계층 트랜잭션, 예외 핸들링, AOP 기반 롤백 처리 |

<br>


### 🌐 외부 연동

| 설명 | 기술적 고려 방안                        |
|------|----------------------------------|
| 주문 성공 시 외부 데이터 플랫폼으로 안정적으로 전송해야 함 | Mock API 활용, 비동기 메시지 큐, Retry 로직 |

<br>

### 🚀 성능

| 설명 | 기술적 고려 방안 |
|------|------------------|
| 인기 상품 조회 시 성능 저하 없이 빠르게 응답 가능해야 함 | Redis 캐시, 통계 테이블 |
